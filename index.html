<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è‡´æˆ‘çš„æœ‹å‹çš„ä¸€å°ä¿¡</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background: radial-gradient(circle at center, #1a2a6c, #b21f1f, #fdbb2d); /* å¤‡ç”¨ */
            background: radial-gradient(ellipse at bottom, #1B2735 0%, #090A0F 100%);
            height: 100vh;
            font-family: 'Arial', sans-serif;
            perspective: 1000px; /* ä¸º3Dæ—‹è½¬æä¾›é€è§† */
            display: flex;
            justify-content: center;
            align-items: center;
        }
        canvas {
            display: block;
            z-index: 5 !important; /* åœ£è¯æ ‘å±‚çº§ */
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            transition: opacity 2s ease;
        }

        .greetings {
            display: none; /* éšè—åŸæœ‰æ–‡å­—ï¼Œæ”¹ç”¨ç²’å­æ•ˆæœ */
        }
        .greetings h1 {
            font-size: 1.8rem; /* é€‚é…æ‰‹æœºå­—å· */
            letter-spacing: 4px;
            /* æµå…‰é‡‘å­—æ•ˆæœ */
            background: linear-gradient(to right, #fff, #f1c40f, #fff);
            background-size: 200% auto;
            -webkit-background-clip: text;
            color: transparent;
            animation: shine 3s linear infinite;
            text-shadow: 0 0 20px rgba(241, 196, 15, 0.5);
            margin: 0; padding: 0 20px;
        }
        @keyframes shine {
            to { background-position: 200% center; }
        }
        .greetings p {
            font-size: 0.9rem; opacity: 0.8; margin-top: 10px; letter-spacing: 2px;
            color: #bdc3c7;
            text-shadow: 0 0 5px rgba(255,255,255,0.3);
        }

        /* ä¿¡å°æ‰“å¼€æ—¶çš„å…‰æ•ˆ */
        .envelope-wrapper::after {
            content: '';
            position: absolute;
            top: 50%; left: 50%;
            width: 10px; height: 10px;
            background: radial-gradient(circle, rgba(255,255,255,1) 0%, rgba(255,255,255,0) 70%);
            transform: translate(-50%, -50%) scale(0);
            z-index: 1; /* åœ¨ä¿¡å°åé¢ */
            opacity: 0;
            pointer-events: none;
        }
        
        .envelope-wrapper.open-anim::after {
            animation: burst 1s ease-out forwards;
        }

        @keyframes burst {
            0% { transform: translate(-50%, -50%) scale(0); opacity: 1; }
            50% { opacity: 0.8; }
            100% { transform: translate(-50%, -50%) scale(50); opacity: 0; }
        }

        /* --- ç§»åŠ¨ç«¯ä¿¡å° --- */
        .envelope-wrapper {
            position: relative; z-index: 10;
            transform: scale(0.9); /* é»˜è®¤ç¼©å°ä¸€ç‚¹é€‚é…å°å± */
            transition: all 1s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .envelope {
            position: relative; width: 300px; height: 190px;
            background: #d63031; /* åœ£è¯çº¢ */
            border-radius: 10px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.5);
            /* çº¸è´¨çº¹ç† */
            background-image: repeating-linear-gradient(45deg, rgba(255,255,255,0.03) 0px, rgba(255,255,255,0.03) 1px, transparent 1px, transparent 10px);
        }

        /* ä¿¡å°ç›– */
        .envelope::before {
            content: ""; position: absolute; top: 0; left: 0;
            border-left: 150px solid transparent;
            border-right: 150px solid transparent;
            border-top: 110px solid #ff7675; /* äº®ç²‰çº¢/æµ…çº¢ */
            transform-origin: top; transition: transform 0.8s ease; z-index: 3;
            filter: drop-shadow(0 2px 5px rgba(0,0,0,0.2));
        }

        /* ä¿¡å°ä¸»ä½“è£…é¥°çº¿ */
        .envelope::after {
            content: ""; position: absolute; bottom: 0; left: 0;
            border-left: 150px solid #e17055; /* ç¨æµ…çš„çº¢è‰² */
            border-right: 150px solid #e17055;
            border-top: 100px solid transparent; z-index: 2;
        }

        .envelope-text {
            position: absolute; bottom: 20px; width: 100%;
            text-align: center; color: #fff;
            font-size: 1.2rem; letter-spacing: 4px; z-index: 4;
            font-weight: 500;
            text-shadow: 0 1px 2px rgba(0,0,0,0.2);
            font-family: 'Georgia', serif;
        }

        .wax-seal {
            position: absolute; top: 85px; left: 130px;
            width: 40px; height: 40px; background: #fdcb6e;
            border-radius: 50%; z-index: 5;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            display: flex; justify-content: center; align-items: center;
            color: #d63031; font-weight: bold; font-size: 1.5rem;
            border: 3px solid #ffeaa7;
            cursor: pointer;
        }
        
        /* åœ£è¯è£…é¥°ï¼šé‚®ç¥¨ */
        .stamp {
            position: absolute; top: 15px; right: 15px;
            width: 45px; height: 55px;
            background: #fff;
            z-index: 2;
            box-shadow: 1px 1px 3px rgba(0,0,0,0.2);
            display: flex; justify-content: center; align-items: center;
            font-size: 28px;
            transform: rotate(5deg);
            /* é‚®ç¥¨é½¿å­”æ•ˆæœ */
            background-image: radial-gradient(transparent 0, transparent 4px, #fff 4px);
            background-size: 10px 10px;
            background-position: -5px -5px;
            overflow: hidden;
            border: 2px solid rgba(0,0,0,0.05);
        }
        .stamp::after {
            content: "â„ï¸";
        }
        
        /* åœ£è¯è£…é¥°ï¼šå·¦ä¸‹è§’è´´çº¸ */
        .sticker {
            position: absolute; bottom: 15px; left: 15px;
            font-size: 30px; z-index: 4;
            transform: rotate(-10deg);
            filter: drop-shadow(1px 2px 2px rgba(0,0,0,0.2));
        }

        /* çŠ¶æ€åˆ‡æ¢ */
        .open-anim { transform: translateY(150px) scale(0); opacity: 0; pointer-events: none; }
        .envelope-wrapper.open-anim .envelope::before { transform: rotateX(180deg); }

        .show-content canvas { opacity: 1; }
        .show-content .greetings { opacity: 1; }

        /* éŸ³ä¹æ§åˆ¶æŒ‰é’® */
        .music-control {
            position: absolute; top: 20px; right: 20px;
            width: 30px; height: 30px; z-index: 20;
            cursor: pointer; opacity: 0.8;
            display: none; /* é»˜è®¤éšè—ï¼Œæ’­æ”¾æˆåŠŸåæ˜¾ç¤º */
        }
        .music-control svg {
            width: 100%; height: 100%; fill: #fff;
            animation: rotate 4s linear infinite;
        }
        .music-control.paused svg {
            animation-play-state: paused;
            opacity: 0.5;
        }
        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* åœ£è¯è€äººå’Œé›ªæ©‡åŠ¨ç”» - 3D ç¯ç»• */
        .orbit-system {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            transform-style: preserve-3d;
            pointer-events: none;
            opacity: 0;
            transition: opacity 2s ease;
        }

        .show-content .orbit-system {
            opacity: 1;
        }

        .orbit-arm {
            position: absolute;
            top: 0;
            left: 0;
            transform-style: preserve-3d;
            animation: orbit-rotate linear infinite;
        }

        .santa-fly {
            position: absolute;
            top: 0;
            left: 0;
            width: 350px; 
            height: 100px;
            pointer-events: none;
            filter: drop-shadow(0 0 10px rgba(255,255,255,0.5));
            /* åˆå§‹ä½ç½®ï¼šå‘å³åç§»åŠå¾„ï¼Œå¹¶æ—‹è½¬90åº¦ä»¥åˆ‡å‘é£è¡Œ */
            transform: translateX(var(--radius)) rotateY(90deg);
        }

        /* é˜Ÿä¼ 1ï¼šä¸»é˜Ÿ */
        .team-1-arm {
            animation-duration: 20s;
            --radius: 450px;
        }
        .team-1 .santa-fly {
             /* ä¿æŒåŸæœ‰ç¼©æ”¾ */
             transform: translateX(var(--radius)) rotateY(90deg) scale(1);
        }
        /* é˜Ÿä¼ 2ï¼šåƒšæœº */
        .team-2-arm {
            animation-duration: 25s;
            animation-delay: -5s; /* é”™å¼€ä½ç½® */
            --radius: 550px;
            top: -100px; /* é«˜åº¦å·® */
        }
        .team-2 .santa-fly {
            transform: translateX(var(--radius)) rotateY(90deg) scale(0.7);
            opacity: 0.8;
        }
        /* é˜Ÿä¼ 3ï¼šé«˜ç©ºå·¡é€» */
        .team-3-arm {
            animation-duration: 30s;
            animation-delay: -15s;
            --radius: 650px;
            top: -200px;
        }
        .team-3 .santa-fly {
            transform: translateX(var(--radius)) rotateY(90deg) scale(0.5);
            opacity: 0.6;
        }

        @keyframes orbit-rotate {
            0% { transform: rotateY(0deg); z-index: 10; } /* å³ä¾§ (å‰) */
            25% { z-index: 1; } /* åæ–¹å¼€å§‹ */
            50% { transform: rotateY(180deg); z-index: 1; } /* å·¦ä¾§ (å) */
            75% { z-index: 10; } /* å‰æ–¹å¼€å§‹ */
            100% { transform: rotateY(360deg); z-index: 10; } /* å›åˆ°å³ä¾§ */
        }
        
    </style>
</head>
<body>

    <audio id="bgm" src="music.mp3" loop preload="auto"></audio>
    
    <div class="music-control" onclick="toggleMusic()" id="musicBtn" title="åˆ‡æ¢éŸ³ä¹">
        <svg viewBox="0 0 24 24">
            <path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/>
        </svg>
    </div>

    <div class="envelope-wrapper" id="envelopeWrapper">
        <div class="envelope" onclick="openLetter()">
            <div class="wax-seal">ğŸ„</div>
            <div class="envelope-text">To: æˆ‘çš„æœ‹å‹</div>
            <div class="stamp"></div>
            <div class="sticker">ğŸ¦Œ</div>
        </div>
    </div>

    <div class="greetings">
        <h1>ç¥æˆ‘çš„æœ‹å‹åœ£è¯èŠ‚å¿«ä¹</h1>
        <p>âœ¦ å¹³å®‰å–œä¹ Â· ä¸‡äº‹èƒœæ„ âœ¦</p>
    </div>
    
     <!-- 3D ç¯ç»•ç³»ç»Ÿ -->
     <div class="orbit-system">
         <!-- é˜Ÿä¼ 1ï¼šä¸»é˜Ÿ -->
         <div class="orbit-arm team-1-arm">
             <div class="santa-fly team-1">
                 <svg viewBox="0 0 350 100" class="santa-svg">
                     <defs>
                         <linearGradient id="magic-trail-1" x1="0%" y1="0%" x2="100%" y2="0%">
                             <stop offset="0%" style="stop-color:rgba(255,255,200,0)" />
                             <stop offset="100%" style="stop-color:rgba(255,215,0,0.8)" />
                         </linearGradient>
                     </defs>
                     <g class="reindeers">
                         <g transform="translate(130, 42)"><path fill="#fff" d="M30,10 Q35,5 40,10 T50,10 L50,25 L45,40 L40,25 L35,25 L30,40 L25,25 Z" class="deer-body"/><path fill="none" stroke="#fff" stroke-width="2" d="M40,10 L35,0 M45,10 L50,0" class="antlers"/></g>
                         <g transform="translate(180, 40)"><path fill="#fff" d="M30,10 Q35,5 40,10 T50,10 L50,25 L45,40 L40,25 L35,25 L30,40 L25,25 Z" class="deer-body"/><path fill="none" stroke="#fff" stroke-width="2" d="M40,10 L35,0 M45,10 L50,0" class="antlers"/></g>
                         <g transform="translate(230, 38)"><path fill="#fff" d="M30,10 Q35,5 40,10 T50,10 L50,25 L45,40 L40,25 L35,25 L30,40 L25,25 Z" class="deer-body"/><path fill="none" stroke="#fff" stroke-width="2" d="M40,10 L35,0 M45,10 L50,0" class="antlers"/></g>
                         <g transform="translate(280, 35)"><path fill="#fff" d="M30,10 Q35,5 40,10 T50,10 L50,25 L45,40 L40,25 L35,25 L30,40 L25,25 Z" class="deer-body"/><path fill="none" stroke="#fff" stroke-width="2" d="M40,10 L35,0 M45,10 L50,0" class="antlers"/></g>
                     </g>
                     <path fill="none" stroke="rgba(255,255,255,0.4)" stroke-width="1" d="M90,45 L300,45" />
                     <g transform="translate(10, 40)" class="sleigh">
                         <path fill="none" stroke="#fff" stroke-width="3" d="M0,40 Q20,40 40,35 T80,30" />
                         <path fill="none" stroke="#fff" stroke-width="2" d="M10,40 L10,25 M60,33 L60,20" />
                         <path fill="#d63031" d="M10,25 Q10,10 30,10 L70,10 Q90,10 90,20 L80,30 L10,30 Z" />
                         <circle cx="50" cy="5" r="8" fill="#ff7675" />
                         <path fill="#d63031" d="M42,13 L58,13 L50,0 Z" />
                         <path fill="#fff" d="M50,13 Q50,20 50,20" stroke="#fff" stroke-width="4" />
                     </g>
                 </svg>
                 <div class="particles"></div>
             </div>
         </div>

         <!-- é˜Ÿä¼ 2ï¼šåƒšæœº -->
         <div class="orbit-arm team-2-arm">
             <div class="santa-fly team-2">
                 <svg viewBox="0 0 350 100" class="santa-svg">
                     <g class="reindeers">
                         <g transform="translate(130, 42)"><path fill="#eee" d="M30,10 Q35,5 40,10 T50,10 L50,25 L45,40 L40,25 L35,25 L30,40 L25,25 Z" class="deer-body"/><path fill="none" stroke="#eee" stroke-width="2" d="M40,10 L35,0 M45,10 L50,0" class="antlers"/></g>
                         <g transform="translate(180, 40)"><path fill="#eee" d="M30,10 Q35,5 40,10 T50,10 L50,25 L45,40 L40,25 L35,25 L30,40 L25,25 Z" class="deer-body"/><path fill="none" stroke="#eee" stroke-width="2" d="M40,10 L35,0 M45,10 L50,0" class="antlers"/></g>
                         <g transform="translate(230, 38)"><path fill="#eee" d="M30,10 Q35,5 40,10 T50,10 L50,25 L45,40 L40,25 L35,25 L30,40 L25,25 Z" class="deer-body"/><path fill="none" stroke="#eee" stroke-width="2" d="M40,10 L35,0 M45,10 L50,0" class="antlers"/></g>
                     </g>
                     <path fill="none" stroke="rgba(255,255,255,0.3)" stroke-width="1" d="M90,45 L250,45" />
                     <g transform="translate(10, 40)" class="sleigh">
                         <path fill="none" stroke="#eee" stroke-width="3" d="M0,40 Q20,40 40,35 T80,30" />
                         <path fill="none" stroke="#eee" stroke-width="2" d="M10,40 L10,25 M60,33 L60,20" />
                         <path fill="#c0392b" d="M10,25 Q10,10 30,10 L70,10 Q90,10 90,20 L80,30 L10,30 Z" />
                         <circle cx="50" cy="5" r="8" fill="#ff7675" />
                         <path fill="#c0392b" d="M42,13 L58,13 L50,0 Z" />
                         <path fill="#eee" d="M50,13 Q50,20 50,20" stroke="#eee" stroke-width="4" />
                     </g>
                 </svg>
                 <div class="particles"></div>
             </div>
         </div>

         <!-- é˜Ÿä¼ 3ï¼šé«˜ç©ºå·¡é€» -->
         <div class="orbit-arm team-3-arm">
             <div class="santa-fly team-3">
                 <svg viewBox="0 0 350 100" class="santa-svg">
                     <g class="reindeers">
                         <g transform="translate(180, 40)"><path fill="#ddd" d="M30,10 Q35,5 40,10 T50,10 L50,25 L45,40 L40,25 L35,25 L30,40 L25,25 Z" class="deer-body"/><path fill="none" stroke="#ddd" stroke-width="2" d="M40,10 L35,0 M45,10 L50,0" class="antlers"/></g>
                         <g transform="translate(230, 38)"><path fill="#ddd" d="M30,10 Q35,5 40,10 T50,10 L50,25 L45,40 L40,25 L35,25 L30,40 L25,25 Z" class="deer-body"/><path fill="none" stroke="#ddd" stroke-width="2" d="M40,10 L35,0 M45,10 L50,0" class="antlers"/></g>
                     </g>
                     <path fill="none" stroke="rgba(255,255,255,0.2)" stroke-width="1" d="M90,45 L250,45" />
                     <g transform="translate(10, 40)" class="sleigh">
                         <path fill="none" stroke="#ddd" stroke-width="3" d="M0,40 Q20,40 40,35 T80,30" />
                         <path fill="none" stroke="#ddd" stroke-width="2" d="M10,40 L10,25 M60,33 L60,20" />
                         <path fill="#a93226" d="M10,25 Q10,10 30,10 L70,10 Q90,10 90,20 L80,30 L10,30 Z" />
                         <circle cx="50" cy="5" r="8" fill="#ff7675" />
                         <path fill="#a93226" d="M42,13 L58,13 L50,0 Z" />
                         <path fill="#ddd" d="M50,13 Q50,20 50,20" stroke="#ddd" stroke-width="4" />
                     </g>
                 </svg>
                 <div class="particles"></div>
             </div>
         </div>
     </div>
    
    <canvas id="canvas"></canvas>

    <script>
        let isOpened = false; // é˜²æ­¢é‡å¤è§¦å‘

        function openLetter() {
            if (isOpened) return;
            isOpened = true;

            const wrapper = document.getElementById('envelopeWrapper');
            wrapper.classList.add('open-anim');
            
            // æ’­æ”¾éŸ³ä¹é€»è¾‘ï¼ˆç‹¬ç«‹å¤„ç†ï¼Œä¸å½±å“åŠ¨ç”»ï¼‰
            playMusicSafe();
            
            setTimeout(() => {
                document.body.classList.add('show-content');
                init(); 
                animate();
            }, 800);
        }

        function playMusicSafe() {
            try {
                const bgm = document.getElementById('bgm');
                if (!bgm) return;
                
                const playPromise = bgm.play();
                if (playPromise !== undefined) {
                    playPromise.then(() => {
                        const btn = document.getElementById('musicBtn');
                        if (btn) btn.style.display = 'block';
                    }).catch(e => {
                        console.log('è‡ªåŠ¨æ’­æ”¾è¢«æ‹¦æˆªæˆ–æ–‡ä»¶ä¸å­˜åœ¨ï¼Œç”¨æˆ·éœ€æ‰‹åŠ¨æ’­æ”¾', e);
                        // å³ä½¿è‡ªåŠ¨æ’­æ”¾å¤±è´¥ï¼Œä¹Ÿæ˜¾ç¤ºæŒ‰é’®ï¼Œè®©ç”¨æˆ·å¯ä»¥æ‰‹åŠ¨ç‚¹å‡»æ’­æ”¾
                        const btn = document.getElementById('musicBtn');
                        if (btn) {
                            btn.style.display = 'block';
                            btn.classList.add('paused'); // åˆå§‹è®¾ä¸ºæš‚åœçŠ¶æ€å›¾æ ‡
                        }
                    });
                }
            } catch (err) {
                console.error('éŸ³ä¹æ’­æ”¾é€»è¾‘é”™è¯¯:', err);
            }
        }

        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        let width, height, particles = [], snowParticles = [], stars = [];
        let textParticles = []; // æ–‡å­—ç²’å­æ•°ç»„
        let rotationAngle = 0;

        // ç¥ç¦è¯­åˆ—è¡¨ï¼ˆå¸¦é¢œè‰²ï¼‰
        const greetingsList = [
            { text: "è¿½å…‰è€Œé‡ æ²å…‰è€Œè¡Œ", color: "#e74c3c" }, // åœ£è¯çº¢
            { text: "é¡ºé‚æ— è™ çš†å¾—æ‰€æ„¿", color: "#f1c40f" }, // é‡‘è‰²
            { text: "è¾æš®å°”å°” çƒŸç«å¹´å¹´", color: "#2ecc71" }, // ç¿ ç»¿
            { text: "å²å²å¹´å¹´ å…±æ¬¢åŒä¹", color: "#3498db" }, // å¤©è“
            { text: "æµ…äºˆæ·±æ·± é•¿ä¹æœªå¤®", color: "#9b59b6" }, // ç´«è‰²
            { text: "å¥½è¿è¿è¿", color: "#e67e22" }, // æ©™è‰²
            { text: "æœªæ¥å¯æœŸ", color: "#e84393" }  // ç²‰è‰²
        ];
        let currentGreetingIndex = 0;

        // æ ‘çš„é…è‰²æ–¹æ¡ˆ
        const leafColors = ['#2d6a4f', '#40916c', '#52b788', '#74c69d']; // æ·±æµ…ä¸ä¸€çš„ç»¿è‰²
        const ornamentColors = ['#d00000', '#ffba08', '#3f88c5']; // çº¢ã€é‡‘ã€è“è£…é¥°çƒ

        class TextParticle {
            constructor(x, y) {
                this.x = Math.random() * width;
                this.y = Math.random() * height;
                this.tx = x; // ç›®æ ‡X
                this.ty = y; // ç›®æ ‡Y
                this.color = '#f1c40f'; // é‡‘è‰²
                this.size = Math.random() * 2 + 1;
                this.speed = Math.random() * 0.08 + 0.02;
            }
            update() {
                // ç¼“åŠ¨åŠ¨ç”»ï¼šå‘ç›®æ ‡ä½ç½®ç§»åŠ¨
                this.x += (this.tx - this.x) * this.speed;
                this.y += (this.ty - this.y) * this.speed;
            }
            render() {
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        // ç¦»å± Canvas ç”¨äºé‡‡æ ·æ–‡å­—
        const offCanvas = document.createElement('canvas');
        const offCtx = offCanvas.getContext('2d');

        function initText(data) {
            const text = data.text;
            const color = data.color;

            offCanvas.width = width;
            offCanvas.height = 200; // æ–‡å­—åŒºåŸŸé«˜åº¦
            offCtx.clearRect(0, 0, width, 200);
            
            // è®¾ç½®æ–‡å­—æ ·å¼
            let fontSize = window.innerWidth < 500 ? 40 : 60;
            offCtx.font = `bold ${fontSize}px "Microsoft YaHei", sans-serif`;
            offCtx.fillStyle = '#fff';
            offCtx.textAlign = 'center';
            offCtx.textBaseline = 'middle';
            offCtx.fillText(text, width / 2, 100);

            // è·å–åƒç´ æ•°æ®
            const imageData = offCtx.getImageData(0, 0, width, 200).data;
            const gap = 4; // é‡‡æ ·é—´éš”ï¼Œè¶Šå°ç²’å­è¶Šå¯†
            const newTargets = [];

            for (let y = 0; y < 200; y += gap) {
                for (let x = 0; x < width; x += gap) {
                    const index = (y * width + x) * 4;
                    if (imageData[index + 3] > 128) { // å¦‚æœ Alpha > 128ï¼Œè¯´æ˜æœ‰æ–‡å­—
                        // ç›®æ ‡ä½ç½®ï¼šå±å¹•é¡¶éƒ¨ + åç§»
                        newTargets.push({ x: x, y: y + height * 0.15 }); 
                    }
                }
            }

            // æ›´æ–°ç²’å­æ•°ç»„
            if (textParticles.length < newTargets.length) {
                // å¦‚æœç°æœ‰ç²’å­ä¸å¤Ÿï¼Œè¡¥é½
                const diff = newTargets.length - textParticles.length;
                for (let i = 0; i < diff; i++) {
                    textParticles.push(new TextParticle(newTargets[i].x, newTargets[i].y));
                }
            }
            
            // åˆ†é…ç›®æ ‡
            for (let i = 0; i < textParticles.length; i++) {
                if (i < newTargets.length) {
                    textParticles[i].tx = newTargets[i].x;
                    textParticles[i].ty = newTargets[i].y;
                    textParticles[i].color = color; // ä½¿ç”¨é…ç½®çš„é¢œè‰²
                    // ç¨å¾®å¢åŠ ä¸€ç‚¹é€Ÿåº¦ï¼Œè®©æ‹¼å‡‘æ›´å¹²è„†
                    textParticles[i].speed = Math.random() * 0.05 + 0.03;
                } else {
                    // å¤šä½™çš„ç²’å­æ•£å¼€
                    textParticles[i].tx = Math.random() * width;
                    textParticles[i].ty = Math.random() * height;
                    textParticles[i].color = 'rgba(255,255,255,0)'; // éšè—
                }
            }
        }

        class Particle {
            constructor(x, y, z, color, size, type) {
                this.x = x; this.y = y; this.z = z;
                this.color = color; this.size = size;
                this.type = type; // 'leaf', 'ornament', 'star'
                
                // é—ªçƒå‚æ•°
                this.twinkleSpeed = Math.random() * 0.05 + 0.02;
                this.twinkleOffset = Math.random() * Math.PI * 2;
            }
            render() {
                // ç»•Yè½´æ—‹è½¬
                const cos = Math.cos(rotationAngle);
                const sin = Math.sin(rotationAngle);
                const rx = this.x * cos - this.z * sin;
                const rz = this.x * sin + this.z * cos;
                const ry = this.y;

                const perspective = 800;
                const scale = perspective / (perspective + rz + 1000);
                const screenX = rx * scale + width / 2;
                const screenY = ry * scale + height / 2 + 200; // æ ‘å˜å¤§äº†ï¼Œæ•´ä½“ä¸‹ç§»è®©ä½ç½®æ›´åè°ƒ
                
                // é—ªçƒé€»è¾‘
                let alpha = 1;
                if (this.type === 'leaf') {
                    // å¶å­å¾®é—ª
                    alpha = 0.8 + Math.sin(Date.now() * 0.002 + this.twinkleOffset) * 0.2;
                } else if (this.type === 'ornament') {
                    // è£…é¥°çƒé«˜äº®
                    alpha = 0.9 + Math.sin(Date.now() * 0.005 + this.twinkleOffset) * 0.1;
                }

                if (scale > 0) {
                    ctx.fillStyle = this.color;
                    ctx.globalAlpha = alpha;
                    ctx.beginPath();
                    ctx.arc(screenX, screenY, this.size * scale, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.globalAlpha = 1; // é‡ç½®
                }
            }
        }

        class Star {
            constructor() {
                this.reset();
            }
            reset() {
                this.x = Math.random() * width;
                this.y = Math.random() * height * 0.6; // æ˜Ÿæ˜Ÿä¸»è¦åˆ†å¸ƒåœ¨å±å¹•ä¸ŠåŠéƒ¨åˆ†
                this.size = Math.random() * 1.5;
                this.blinkSpeed = Math.random() * 0.05 + 0.01;
                this.alpha = Math.random();
            }
            render() {
                this.alpha += this.blinkSpeed;
                if(this.alpha > 1 || this.alpha < 0) this.blinkSpeed = -this.blinkSpeed;
                
                const currentAlpha = Math.abs(this.alpha);
                ctx.fillStyle = `rgba(255, 255, 255, ${currentAlpha * 0.8})`;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        class SnowParticle {
            constructor() {
                this.reset();
            }
            reset() {
                this.x = Math.random() * width;
                this.y = Math.random() * -height; // ä»å±å¹•ä¸Šæ–¹éšæœºä½ç½®å¼€å§‹
                this.z = Math.random() * 0.8 + 0.2; // æ·±åº¦ç³»æ•°ï¼Œå½±å“å¤§å°å’Œé€Ÿåº¦
                this.size = Math.random() * 2 + 1;
                // é›ªèŠ±åŠ é€Ÿï¼šé€Ÿåº¦èŒƒå›´æ”¹ä¸º 2.5 ~ 5.5
                this.speedY = Math.random() * 3 + 2.5; 
                this.speedX = (Math.random() - 0.5) * 1.5; // ç¨å¾®å¢åŠ æ¨ªå‘é£˜åŠ¨
                this.opacity = Math.random() * 0.6 + 0.4;
            }
            update() {
                this.y += this.speedY * this.z;
                this.x += this.speedX * this.z;
                
                // é£˜å‡ºå±å¹•åº•éƒ¨æˆ–å·¦å³è¾¹ç•Œå¤ªè¿œåˆ™é‡ç½®
                if (this.y > height || this.x > width + 100 || this.x < -100) {
                    this.reset();
                    this.y = -10; // ç¡®ä¿ä»é¡¶éƒ¨é‡æ–°å¼€å§‹
                }
            }
            render() {
                ctx.globalCompositeOperation = 'source-over'; // é›ªèŠ±éœ€è¦è¦†ç›–åœ¨èƒŒæ™¯ä¸Š
                ctx.fillStyle = `rgba(255, 255, 255, ${this.opacity})`;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size * this.z, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        function init() {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
            particles = [];
            snowParticles = []; // é‡ç½®é›ªèŠ±æ•°ç»„
            stars = []; // é‡ç½®æ˜Ÿæ˜Ÿæ•°ç»„
            
            // åˆå§‹åŒ–æ˜Ÿæ˜Ÿ
            const starCount = window.innerWidth < 500 ? 50 : 100;
            for(let i=0; i<starCount; i++) {
                stars.push(new Star());
            }

            // åˆå§‹åŒ–æ›´é€¼çœŸçš„3Dåœ£è¯æ ‘
            // å¢å¤§å°ºå¯¸
            const treeHeight = window.innerWidth < 500 ? 550 : 700; // æ‰‹æœºä¸Šç¨å¾®å°ä¸€ç‚¹ï¼ŒPCä¸Šå¤§ä¸€ç‚¹
            const maxRadius = window.innerWidth < 500 ? 220 : 300;
            // å¢åŠ ç²’å­å¯†åº¦
            const particleCount = window.innerWidth < 500 ? 1800 : 3000;
            
            for(let i = 0; i < particleCount; i++) {
                // ä½¿ç”¨èºæ—‹åˆ†å¸ƒç”Ÿæˆåœ†é”¥ä½“
                const h = Math.random(); // 0 (é¡¶ç«¯) åˆ° 1 (åº•éƒ¨)
                const y = -treeHeight + h * treeHeight; // æ˜ å°„åˆ°Yè½´
                const radius = h * maxRadius; // åŠå¾„éšé«˜åº¦çº¿æ€§å¢åŠ 
                
                // èºæ—‹è§’åº¦
                const angle = i * 0.1 + Math.random() * 0.5;
                const r = Math.random() * radius; // å¡«å……å†…éƒ¨
                
                const x = Math.cos(angle) * r;
                const z = Math.sin(angle) * r;
                
                // å†³å®šç²’å­ç±»å‹
                const typeRand = Math.random();
                let color, size, type;
                
                if (typeRand > 0.95) {
                    // 5% æ˜¯è£…é¥°çƒ
                    color = ornamentColors[Math.floor(Math.random() * ornamentColors.length)];
                    size = Math.random() * 3 + 2;
                    type = 'ornament';
                    // è£…é¥°çƒå€¾å‘äºåœ¨å¤–å±‚
                    if (r < radius * 0.8) { 
                        // å¦‚æœéšæœºåœ¨å†…éƒ¨ï¼Œå¼ºåˆ¶ç§»åˆ°è¡¨é¢
                        const surfaceR = radius * (0.9 + Math.random() * 0.1);
                        const sx = Math.cos(angle) * surfaceR;
                        const sz = Math.sin(angle) * surfaceR;
                        particles.push(new Particle(sx, y, sz, color, size, type));
                        continue;
                    }
                } else {
                    // 95% æ˜¯å¶å­
                    color = leafColors[Math.floor(Math.random() * leafColors.length)];
                    size = Math.random() * 2 + 0.5;
                    type = 'leaf';
                }
                
                particles.push(new Particle(x, y, z, color, size, type));
            }
            
            // æ ‘é¡¶å¤§æ˜Ÿæ˜Ÿ
            particles.push(new Particle(0, -treeHeight - 10, 0, '#ffd700', 8, 'ornament'));
            
            // åˆå§‹åŒ–é›ªèŠ±
            const snowCount = window.innerWidth < 500 ? 100 : 200;
            for (let i = 0; i < snowCount; i++) {
                const snow = new SnowParticle();
                // åˆå§‹æ—¶è®©é›ªèŠ±åˆ†å¸ƒåœ¨æ•´ä¸ªå±å¹•ï¼Œè€Œä¸ä»…ä»…æ˜¯é¡¶éƒ¨
                snow.y = Math.random() * height;
                snowParticles.push(snow);
            }

            // åˆå§‹åŒ–ç¬¬ä¸€å¥ç¥ç¦è¯­
            initText(greetingsList[currentGreetingIndex]);
            
            // å¯åŠ¨å®šæ—¶å™¨åˆ‡æ¢ç¥ç¦è¯­
            setInterval(() => {
                currentGreetingIndex = (currentGreetingIndex + 1) % greetingsList.length;
                initText(greetingsList[currentGreetingIndex]);
            }, 10000); // å»¶é•¿åˆ°10ç§’ï¼Œç¡®ä¿æœ‰è¶³å¤Ÿæ—¶é—´æ‹¼å‡‘å’Œå±•ç¤º
        }

        function animate() {
            if (!isOpened) return; // ä¿¡å°æœªæ‰“å¼€ä¸æ’­æ”¾åŠ¨ç”»

            // æ¸…é™¤ç”»å¸ƒï¼ˆå®Œå…¨é€æ˜ï¼Œä»¥æ˜¾ç¤º CSS èƒŒæ™¯ï¼‰
            ctx.clearRect(0, 0, width, height);
            
            // æ¸²æŸ“æ˜Ÿæ˜Ÿ
            ctx.globalCompositeOperation = 'lighter';
            stars.forEach(s => s.render());

            // æ¸²æŸ“æ ‘
            ctx.globalCompositeOperation = 'source-over';
            particles.forEach(p => {
                // p.update(); // Particle æ²¡æœ‰ update æ–¹æ³•ï¼Œæ—‹è½¬é€»è¾‘åœ¨ render ä¸­
                p.render();
            });
            
            // æ¸²æŸ“æ–‡å­—ç²’å­
            textParticles.forEach(p => {
                p.update();
                p.render();
            });
            
            // æ¸²æŸ“é›ªèŠ±
            snowParticles.forEach(p => {
                p.update();
                p.render();
            });

            rotationAngle -= 0.004; 
            requestAnimationFrame(animate);
        }

        window.addEventListener('resize', () => { if(particles.length > 0) init(); });
    </script>
</body>
</html>